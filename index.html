<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Journal Day One</title>

<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">

<!-- === CSS Moderne inspirÃ© du template Day One === -->
<style>
body { 
  font-family:Segoe UI, Arial, sans-serif; 
  font-size:0.9em; 
  background:#f6f7fb; 
  margin:0; padding:2em;
  display:flex; flex-direction:row; gap:2em; align-items:flex-start;
  transition: background 0.3s, color 0.3s;
}
body.dark { background:#0b1220; color:#e6eef8; }

main { flex:1; }
aside { width:250px; background:#fff; border-radius:10px; box-shadow:0 3px 12px rgba(0,0,0,0.08); padding:1em; }
body.dark aside { background:#1c2330; }

.entry { background:#fff; border-radius:10px; padding:1em 1.5em; margin-bottom:1.5em; box-shadow:0 3px 12px rgba(0,0,0,0.08); }
body.dark .entry { background:#212835; }

.meta { color:#666; font-size:0.85em; margin-bottom:6px; }
body.dark .meta { color:#ccc; }

.tags { color:#0a58ca; font-size:0.8em; margin-bottom:6px; }
body.dark .tags { color:#60a5fa; }

h1, h2, h3 { margin:0.5em 0; }

blockquote { margin:0.5em 0; padding-left:12px; border-left:3px solid #dbeafe; color:#334155; }
body.dark blockquote { border-left: #2563eb; color:#e6eef8; }

img { max-width:100%; border-radius:8px; margin:6px 0; }

button { padding:0.3em 0.8em; border:1px solid #ccc; background:#eee; border-radius:6px; cursor:pointer; }
button:hover { background:#ddd; }

.calendar { display:inline-block; background:#fff; padding:1em; border-radius:12px; box-shadow:0 3px 12px rgba(0,0,0,0.08); margin-bottom:1.5em; }
body.dark .calendar { background:#1c2330; }

#darkToggle { margin-bottom:16px; }
</style>
</head>
<body>

<!-- Toggle mode sombre -->
<button id="darkToggle">ðŸŒ™ Mode sombre</button>

<aside>
  <h3>Calendrier</h3>
  <div id="calendar" class="calendar"></div>

  <div class="taglist">
    <h3>Tags</h3>
    <div id="tagContainer">(chargement...)</div>
  </div>

  <div style="text-align:center;margin-top:1em">
    <button id="clearFilter">Tout afficher</button>
  </div>
</aside>

<main>
  <h1>Mon Journal Day One</h1>

  <div class="panel">
    <h3>Nouvelle entrÃ©e</h3>
    <input id="newTitle" placeholder="Titre"><br>
    <textarea id="newContent" placeholder="Texte"></textarea><br>
    <input id="newTags" placeholder="Tags (sÃ©parÃ©s par |)"><br>
    <button id="addEntryBtn">Ajouter</button>
  </div>

  <div id="entries"></div>
</main>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB-DfZugoODC32gUqZH8lU6IJ2Kq2MSGng",
  authDomain: "mon-journal-d5e59.firebaseapp.com",
  projectId: "mon-journal-d5e59",
  storageBucket: "mon-journal-d5e59.firebasestorage.app",
  messagingSenderId: "695080304385",
  appId: "1:695080304385:web:8b0beb7d3f314a2ffe2500",
  measurementId: "G-5RXVSVPHM9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// === Mode sombre toggle ===
const darkToggle = document.getElementById('darkToggle');
darkToggle.onclick = () => document.body.classList.toggle('dark');

// === Variables ===
let entries = [];
const entriesEl = document.getElementById('entries');
const tagContainer = document.getElementById('tagContainer');
const calendarEl = document.getElementById('calendar');
let calendar;

// === Initialiser FullCalendar ===
function initCalendar() {
  calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    height: 400,
    events: []
  });
  calendar.render();
}
initCalendar();

// === Ajouter une entrÃ©e ===
document.getElementById('addEntryBtn').onclick = async () => {
  const title = document.getElementById('newTitle').value.trim();
  const content = document.getElementById('newContent').value.trim();
  const tags = document.getElementById('newTags').value.trim();

  if (!title || !content) return alert("Titre et texte requis");

  const date = new Date().toISOString().slice(0,10);
  const entry = { title, content, tags, date, created: new Date().toISOString() };
  const docRef = await db.collection('entries').add(entry);
  entry.id = docRef.id;

  entries.push(entry);
  updateUI();
  document.getElementById('newTitle').value = '';
  document.getElementById('newContent').value = '';
  document.getElementById('newTags').value = '';
};

// === Charger les entrÃ©es depuis Firebase ===
async function loadEntries() {
  const snapshot = await db.collection('entries').orderBy('created','desc').get();
  entries = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  updateUI();
}
loadEntries();

// === Mettre Ã  jour lâ€™UI ===
function updateUI() {
  // Calendrier
  calendar.removeAllEvents();
  entries.forEach(e => calendar.addEvent({ title: e.title, start: e.date }));

  // EntrÃ©es
  entriesEl.innerHTML = '';
  entries.forEach(e => {
    const div = document.createElement('div');
    div.className = 'entry';
    div.dataset.date = e.date;
    div.dataset.tags = e.tags || '';
    div.innerHTML = `
      <div class="tags">Tags : ${e.tags}</div>
      <div class="meta">Le ${new Date(e.created).toLocaleString()}</div>
      <div><h2>${e.title}</h2>${e.content}</div>
    `;
    entriesEl.appendChild(div);
  });

  // Tags
  renderTags();
}

// === Tags ===
function renderTags() {
  const tagCounts = {};
  entries.forEach(e => {
    const tags = (e.tags||'').split('|').filter(Boolean);
    tags.forEach(t => tagCounts[t] = (tagCounts[t]||0)+1);
  });
  tagContainer.innerHTML = '';
  Object.entries(tagCounts).sort().forEach(([tag,count])=>{
    const span = document.createElement('span');
    span.className = 'tag';
    span.textContent = `${tag} (${count})`;
    span.onclick = () => filterByTag(tag);
    tagContainer.appendChild(span);
  });
}

function filterByTag(tag) {
  entriesEl.querySelectorAll('.entry').forEach(e=>{
    e.style.display = (e.dataset.tags.split('|').includes(tag)) ? 'block' : 'none';
  });
}

document.getElementById('clearFilter').onclick = () => {
  entriesEl.querySelectorAll('.entry').forEach(e=>e.style.display='block');
}
</script>

</body>
</html>
